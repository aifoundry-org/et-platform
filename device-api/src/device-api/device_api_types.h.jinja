/*------------------------------------------------------------------------------
 * Copyright (C) 2019, Esperanto Technologies Inc.
 * The copyright to the computer program(s) herein is the
 * property of Esperanto Technologies, Inc. All Rights Reserved.
 * The program(s) may be used and/or copied only with
 * the written permission of Esperanto Technologies and
 * in accordance with the terms and conditions stipulated in the
 * agreement/contract under which the program(s) have been supplied.
 ------------------------------------------------------------------------------ */

// WARNING: this file is auto-generated do not edit directly

#ifndef ET_DEVICE_API_TYPES_<< cgh.c_api_name | upper >>_H
#define ET_DEVICE_API_TYPES_<< cgh.c_api_name | upper >>_H

#include "device_api_message_types.h"

#include <stdint.h>

#ifdef __cplusplus

#include <ostream>

namespace device_api {
#endif

// 8 LSB bytes MD5 checksum of the device-api spec
#define DEVICE_API_<<cgh.c_api_name | upper>>_HASH  0x<< cgh.spec_hash() >>ULL
#define DEVICE_API_<<cgh.c_api_name | upper>>_MAJOR <<cgh.spec_data['Version_Major']>>
#define DEVICE_API_<<cgh.c_api_name | upper>>_MINOR <<cgh.spec_data['Version_Minor']>>
#define DEVICE_API_<<cgh.c_api_name | upper>>_PATCH <<cgh.spec_data['Version_Patch']>>

// DeviceAPI Enumerations
<% for enum in cgh.enums() -%>

typedef << enum["Type"] >> << enum.c_type_name>>;

/// @brief << enum["Description"] >>
enum << enum.Name | upper >> {
  <% for val in enum.Values -%>
  << enum.Name | upper >>_<< val["Name"] >> = << val["Value"] >>,
  <% endfor %>
};

<% endfor %>

// DeviceAPI structs
// Structs that are being used in other tests

<% for struct in cgh.structs() -%>
/// @brief << struct["Description"] >>
struct << struct["Name"] >> {
  <% for field in struct.get("Fields", []) -%>
  << cgh.message_field_type(field) >>  << field["Name"] >>;
  <% endfor %>
};

<% endfor %>

// Device API Enum
typedef uint64_t device_api_msg_t;

enum device_api_msg_e {
    MBOX_DEVAPI_MESSAGE_ID_NONE = << cgh.message_start_id >>,
<%- for message in cgh.messages() %>
    MBOX_DEVAPI_MESSAGE_ID_<< message["Name"] | upper >> = << cgh.message_start_id + loop.index >>,
<%- endfor %>
    MBOX_DEVAPI_MESSAGE_ID_LAST  = << cgh.message_max_id >>
};

// The real RPC messages that we exchange
<% for message in cgh.messages() %>
/// @brief << message["Description"] >>
struct << message["Name"] >>_t {
  <%- if message['Type'] == 'Command' %>
  struct command_header_t command_info;
  <%- elif message['Type'] == 'Response' %>
  struct response_header_t response_info;
  <%- else %>
  struct event_header_t event_info;
  <%- endif %>
  <%- for field in message.get("Fields", []) %>
  <% if field['Type'] == 'struct' -%> struct <% endif -%>
  << cgh.message_field_type(field) >>  << field["Name"] >>; /// << field["Description"] >>
  <%- endfor %>
};
<% endfor %>

#ifdef __cplusplus

// Overloads of the operators<<"<<">> to enable outputing the structs in C++

<% for struct in cgh.structs() -%>
/// @brief Output << struct["Description"] >>
static inline std::ostream& operator<< "<<" >>(std::ostream& output, const << struct['Name'] >>& obj)
{
  output
  <% for field in struct.get("Fields", []) -%>
  << "<< \"" >> << field["Name"] >><< ":\" <<" >> obj.<< field["Name"] >>
  <% endfor %>;

  return output;
};
<% endfor %>


} // namespace device_api
#endif

#endif // ET_DEVICE_API_TYPES_<< cgh.c_api_name | upper >>_H
