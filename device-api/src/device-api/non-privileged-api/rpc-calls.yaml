#------------------------------------------------------------------------------
# Copyright (C) 2019, Esperanto Technologies Inc.
# The copyright to the computer program(s) herein is the
# property of Esperanto Technologies, Inc. All Rights Reserved.
# The program(s) may be used and/or copied only with
# the written permission of Esperanto Technologies and
# in accordance with the terms and conditions stipulated in the
# agreement/contract under which the program(s) have been supplied.
#------------------------------------------------------------------------------

Name: RPC_Calls
## List of Enums that are used in our messages
Enums:
  - Name: log_levels
    Type: uint64_t
    Values:
      - Name: CRITICAL
        Value: 0
      - Name: ERROR
        Value: 1
      - Name: WARNING
        Value: 2
      - Name: INFO
        Value: 3
      - Name: DEBUG
        Value: 4
      - Name: TRACE
        Value: 5
      - Name: NONE
        Value: 6
  - Name: trace_status
    Type: int32_t
    Values:
      - Name: SUCCESS
        Value: 0
      - Name: BUFFER_FULL
        Value: 1
      - Name: INVALID_VAL
        Value: 2
      - Name: DISABLED
        Value: 3
  - Name: dev_api_kernel_launch_error
    Type: uint32_t
    Values:
      - Name: OK
        Value: 0
      - Name: SHIRES_NOT_READY
        Value: 1
      - Name: ERROR
        Value: 2
      - Name: RESULT_OK
        Value: 3
      - Name: RESULT_ERROR
        Value: 4
  - Name: dev_api_error_type
    Type: uint32_t
    Values:
      - Name: NONE
        Value: 0
      - Name: ASYNC_ERROR_0
        Value: 1
  - Name: dev_api_kernel_abort_response_result
    Type: uint32_t
    Values:
      - Name: NONE
        Value: 0
      - Name : OK
        Value : 1
      - Name : ERROR
        Value : 2
  - Name: dev_api_kernel_state
    Type: uint32_t
    Values:
      - Name: UNUSED
        Value: 0
      - Name: LAUNCHED
        Value: 1
      - Name: RUNNING
        Value: 2
      - Name: ABORTED
        Value: 3
      - Name: ERROR
        Value: 4
      - Name: COMPLETE
        Value: 5

# List of Structs used in our messages
Structs:
  - Name : dev_api_kernel_params_t
    Fields:
      - Name: tensor_a
        Type: uint64_t
      - Name: tensor_b
        Type: uint64_t
      - Name: tensor_c
        Type: uint64_t
      - Name: tensor_d
        Type: uint64_t
      - Name: tensor_e
        Type: uint64_t
      - Name: tensor_f
        Type: uint64_t
      - Name: tensor_g
        Type: uint64_t
      - Name: tensor_h
        Type: uint64_t
      - Name: kernel_id
        Type: uint64_t
  - Name: dev_api_kernel_info_t
    Fields:
      - Name: compute_pc
        Type: uint64_t
      - Name: uber_kernel_nodes
        Type: uint64_t
      - Name: shire_mask
        Type: uint64_t

# List of Commands, Responses, Events that the RPC
# DeviceAPI can exchange with the host
Messages :
  #-------------------------------------------------------------------------------
  - Name: reflect_test_cmd
    Description: Reflect test command
    Type: Command
    PairedMessage: reflect_test_rsp
    Fields:
      - Name: dummy
        Type: bool
  - Name: reflect_test_rsp
    Description:  Reflect test reply
    Type: Response
    PairedMessage: reflect_test_cmd
    Fields:
      - Name: dummy
        Type: bool
#-------------------------------------------------------------------------------
  - Name: device_fw_version_cmd
    Description:  Request the device-fw version. Use the 8 bytes of the uint64_t
                  to store 8 characters of the git-hash.
    Type: Command
    PairedMessage: device_fw_version_rsp
    Fields:
      - Name: runtime_commit
        Type: uint64_t
  - Name: device_fw_version_rsp
    Description:  Reply, the 8 bytes of the uint64_t to store 8 characters of the git-hash.
    Type: Response
    PairedMessage: device_fw_version_cmd
    Fields:
      - Name: device_fw_commit
        Type: uint64_t
#-------------------------------------------------------------------------------
  - Name: device_api_version_cmd
    Description:  Request the version of the device_api supported
                  by the target, advertise the one we support
    Type: Command
    PairedMessage: device_api_version_rsp
    Fields:
      - Name: major
        Type: uint64_t
      - Name: minor
        Type: uint64_t
      - Name: patch
        Type: uint64_t
      - Name: api_hash
        Type: uint64_t
  - Name: device_api_version_rsp
    Type: Response
    Description: Return the version implemented by the target
    PairedMessage: device_api_version_cmd
    Fields:
      - Name: major
        Type: uint64_t
      - Name: minor
        Type: uint64_t
      - Name: patch
        Type: uint64_t
      - Name: api_hash
        Type: uint64_t
      - Name: accept
        Description: Set to true by the targert if it can support
                     the version provided by the requestor
        Type: bool
#-------------------------------------------------------------------------------
  - Name: kernel_launch_cmd
    Description: Launch a kernel on the target
    PairedMessage: kernel_launch_rsp
    Type: Command
    Fields:
      - Name: kernel_params
        Type : struct
        Struct: dev_api_kernel_params_t
      - Name: kernel_info
        Type: struct
        Struct: dev_api_kernel_info_t
      - Name: uber_kernel
        Type: bool
        Description: True if we are lauching an uber kernel.
  - Name: kernel_launch_rsp
    Description: Response and result of a kernel launch on the device
    Type: Response
    PairedMessage: kernel_launch_cmd
    Fields:
      - Name: kernel_id
        Type: uint64_t
      - Name: error
        Type: enum
        Enum: dev_api_kernel_launch_error
#-------------------------------------------------------------------------------
  - Name: kernel_abort_cmd
    Description: Command to abort a currently running kernel on the device
    Type: Command
    PairedMessage: kernel_abort_rsp
    Fields:
      - Name: kernel_id
        Type: uint64_t
  - Name: kernel_abort_rsp
    Description: Response to an abort request
    PairedMessage: kernel_abort_cmd
    Type: Response
    Fields:
      - Name: status
        Type: enum
        Enum: dev_api_kernel_abort_response_result
#-------------------------------------------------------------------------------
  - Name: kernel_state_cmd
    Description: Query the state if a currently running kernel
    Type: Command
    PairedMessage: kernel_state_rsp
    Fields:
      - Name: kernel_id
        Type: uint64_t
  - Name: kernel_state_rsp
    Description: Kernel state reply
    Type: Response
    PairedMessage: kernel_state_cmd
    Fields:
      - Name: status
        Type: uint64_t
#-------------------------------------------------------------------------------
  - Name: set_master_log_level_cmd
    Description: Set the master shire logging level
    Type: Command
    PairedMessage: set_master_log_level_rsp
    Fields:
      - Name: log_level
        Type: enum
        Enum: log_levels
  - Name: set_master_log_level_rsp
    Type: Response
    PairedMessage: set_master_log_level_cmd
    Fields:
      - Name: status
        Type: bool
#-------------------------------------------------------------------------------
  - Name: set_worker_log_level_cmd
    Description: Set the worker shire logging level
    Type: Command
    PairedMessage: set_worker_log_level_rsp
    Fields:
      - Name: log_level
        Type: enum
        Enum: log_levels
  - Name: set_worker_log_level_rsp
    Type: Response
    PairedMessage: set_worker_log_level_cmd
    Fields:
      - Name: status
        Type: bool
#-------------------------------------------------------------------------------
  ### List of asynchronous events that device-fw can send to the host
  - Name: device_fw_error
    Description: Generic error reported by the device
    Type: Event
    PairedMessage: None
    Fields:
      - Name: error_type
        Type: enum
        Enum: dev_api_error_type
#-------------------------------------------------------------------------------
  - Name: discover_trace_buffer_cmd
    Description: Discover the trace buffer address, size and knob states
    Type: Command
    PairedMessage: discover_trace_buffer_rsp
    Fields:
      - Name: dummy
        Type: bool
  - Name: discover_trace_buffer_rsp
    Type: Response
    PairedMessage: discover_trace_buffer_cmd
    Fields:
      - Name: trace_base
        Type: uint64_t
      - Name: trace_mem_size
        Type: uint64_t
      - Name: status
        Type: enum
        Enum: trace_status_e
#-------------------------------------------------------------------------------
  - Name: configure_trace_group_knob_cmd
    Description: Configure the state of a trace group
    Type: Command
    PairedMessage: configure_trace_group_knob_rsp
    Fields:
      - Name: group_id
        Type: uint64_t
      - Name: enabled
        Type: bool
  - Name: configure_trace_group_knob_rsp
    Type: Response
    PairedMessage: configure_trace_group_knob_cmd
    Fields:
      - Name: status
        Type: bool
#-------------------------------------------------------------------------------
  - Name: configure_trace_event_knob_cmd
    Description: Configure the logging level of a group
    Type: Command
    PairedMessage: configure_trace_event_knob_rsp
    Fields:
      - Name: event_id
        Type: uint64_t
      - Name: log_level
        Type: enum
        Enum: log_levels_e
      - Name: uart_log_enabled
        Type: bool
  - Name: configure_trace_event_knob_rsp
    Type: Response
    PairedMessage: configure_trace_event_knob_cmd
    Fields:
      - Name: status
        Type: bool
#-------------------------------------------------------------------------------
  - Name: configure_trace_buffer_size_knob_cmd
    Description: Configure the trace buffer size
    Type: Command
    PairedMessage: configure_trace_buffer_size_knob_rsp
    Fields:
      - Name: buffer_size
        Type: uint32_t
  - Name: configure_trace_buffer_size_knob_rsp
    Type: Response
    PairedMessage: configure_trace_buffer_size_knob_cmd
    Fields:
      - Name: status
        Type: bool
