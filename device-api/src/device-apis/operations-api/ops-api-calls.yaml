#------------------------------------------------------------------------------
# Copyright (C) 2019, Esperanto Technologies Inc.
# The copyright to the computer program(s) herein is the
# property of Esperanto Technologies, Inc. All Rights Reserved.
# The program(s) may be used and/or copied only with
# the written permission of Esperanto Technologies and
# in accordance with the terms and conditions stipulated in the
# agreement/contract under which the program(s) have been supplied.
#------------------------------------------------------------------------------
Name: Ops_API_Calls
## List of Enums that are used in our messages
Enums:
  - Name: log_levels
    Type: uint8_t
    Values:
      - Name: CRITICAL
        Value: 0
      - Name: ERROR
        Value: 1
      - Name: WARNING
        Value: 2
      - Name: INFO
        Value: 3
      - Name: DEBUG
        Value: 4
      - Name: TRACE
        Value: 5
  - Name: dev_ops_api_kernel_launch_response
    Type: uint32_t
    Values:
      - Name: KERNEL_COMPLETED
        Value: 0
      - Name: ERROR
        Value: 1
      - Name: EXCEPTION
        Value: 2
      - Name: SHIRES_NOT_READY
        Value: 3
      - Name: HOST_ABORTED
        Value: 4
      - Name: INVALID_ADDRESS
        Value: 5
  - Name: dev_ops_api_kernel_abort_response
    Type: uint32_t
    Values:
      - Name: SUCCESS
        Value: 0
      - Name : ERROR
        Value : 1
      - Name : INVALID_TAG_ID
        Value : 2
  - Name: dev_ops_api_dma_response
    Type: uint32_t
    Values:
      - Name: COMPLETE
        Value: 0
      - Name: ERROR
        Value: 1
      - Name: TIMEOUT_IDLE_CHANNEL_UNAVAILABLE
        Value: 2
      - Name: ABORTED
        Value: 3
      - Name: INVALID_ADDRESS
        Value: 4
  - Name: dev_ops_api_error_type
    Type: uint32_t
    Values:
      - Name: NONE
        Value: 0
      - Name: ASYNC_ERROR_0
        Value: 1
  - Name: dev_ops_fw_type
    Type: uint8_t
    Values:
      - Name: MASTER_MINION_FW
        Value: 0
      - Name: MACHINE_MINION_FW
        Value: 1
      - Name: WORKER_MINION_FW
        Value: 2
  - Name: dev_ops_trace_response
    Type: int8_t
    Values:
      - Name: SUCCESS
        Value: 0
      - Name: BAD_GROUP_INDEX
        Value: -1
      - Name: BAD_MASTER_SHIRE_MASK
        Value: -2

## List of Commands, Responses, and Events
Messages :
#-------------------------------------------------------------------------------
  - Name: check_device_ops_api_compatibility_cmd
    Description:  Request the version of the device_ops_api supported
                  by the target, advertise the one we support
    Type: Command
    PairedMessage: device_ops_api_compatibility_rsp
    Fields:
      - Name: major
        Description: Sem Version Major
        Type: uint16_t
      - Name: minor
        Description: Sem Version Minor
        Type: uint16_t
      - Name: patch
        Description: Sem Version Patch
        Type: uint16_t
      - Name: pad
        Description: Padding for alignment
        Type: uint16_t
  - Name: device_ops_api_compatibility_rsp
    Type: Response
    Description: Return the version implemented by the target
    PairedMessage: check_device_ops_api_compatibility_cmd
    Fields:
      - Name: major
        Description: Sem Version Major
        Type: uint16_t
      - Name: minor
        Description: Sem Version Minor
        Type: uint16_t
      - Name: patch
        Description: Sem Version Patch
        Type: uint16_t
      - Name: pad
        Description: Padding for alignment
        Type: uint16_t
#-------------------------------------------------------------------------------
  - Name: device_ops_device_fw_version_cmd
    Description:  Request the version of the device firmware, advertise the one we support
    Type: Command
    PairedMessage: device_ops_fw_version_rsp
    Fields:
      - Name: firmware_type
        Description: Identify device firmware type
        Type: enum
        Enum: dev_ops_fw_type
      - Name: pad1
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad2
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad3
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad4
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad5
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad6
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad7
        Description: Padding for alignment
        Type: uint8_t
  - Name: device_ops_fw_version_rsp
    Type: Response
    Description: Return the device fw version for the requested type
    PairedMessage: device_ops_device_fw_version_cmd
    Fields:
      - Name: major
        Description: Sem Version Major
        Type: uint16_t
      - Name: minor
        Description: Sem Version Minor
        Type: uint16_t
      - Name: patch
        Description: Sem Version Patch
        Type: uint16_t
      - Name: type
        Description: Device firmware type
        Type: enum
        Enum: dev_ops_fw_type
      - Name: pad
        Description: Padding for alignment
        Type: uint8_t
#-------------------------------------------------------------------------------
  - Name: device_ops_echo_cmd
    Description: Echo command
    Type: Command
    PairedMessage: device_ops_echo_rsp
    Fields:
      - Name: echo_payload
        Description: Echo payload field
        Type: int32_t
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
  - Name: device_ops_echo_rsp
    Description:  Echo response
    Type: Response
    PairedMessage: device_ops_echo_cmd
    Fields:
      - Name: echo_payload
        Description: Echo payload field
        Type: int32_t
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
# Kernel Execution Commands and Responses
#-------------------------------------------------------------------------------
  - Name: device_ops_kernel_launch_cmd
    Description: Launch a kernel on the target
    PairedMessage: device_ops_kernel_launch_rsp
    Type: Command
    Fields:
      - Name: code_start_address
        Description: Code start address
        Type : uint64_t
      - Name: pointer_to_args
        Description: Pointer to kernel arguments
        Type : uint64_t
      - Name: shire_mask
        Description: Mask of Shires involved in the kernel launch
        Type : uint64_t
  - Name: device_ops_kernel_launch_rsp
    Description: Response and result of a kernel launch on the device
    Type: Response
    PairedMessage: device_ops_kernel_launch_cmd
    Fields:
      - Name: cmd_wait_time
        Description: Time transpired between command arrival and dispatch
        Type: uint64_t
      - Name: cmd_execution_time
        Description: Time transpired between command dispatch and command completion
        Type: uint64_t
      - Name: status
        Description: Kernel Launch status
        Type: enum
        Enum: dev_ops_api_kernel_launch_response
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
  - Name: device_ops_kernel_abort_cmd
    Description: Command to abort a currently running kernel on the device
    Type: Command
    PairedMessage: device_ops_kernel_abort_rsp
    Fields:
      - Name: kernel_launch_tag_id
        Description: Tag ID of the kernel_launch command the we want to abort
        Type: uint16_t
      - Name: pad1
        Description: Padding for alignment
        Type: uint16_t
      - Name: pad2
        Description: Padding for alignment
        Type: uint16_t
      - Name: pad3
        Description: Padding for alignment
        Type: uint16_t
  - Name: device_ops_kernel_abort_rsp
    Description: Response to an abort request
    PairedMessage: device_ops_kernel_abort_cmd
    Type: Response
    Fields:
      - Name: status
        Description: Kernel Abort status
        Type: enum
        Enum: dev_ops_api_kernel_abort_response
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
# Data Transfer Commands and Responses
#-------------------------------------------------------------------------------
  - Name: device_ops_data_read_cmd
    Description: Command to read data from device memory
    Type: Command
    PairedMessage: device_ops_data_read_rsp
    Fields:
      - Name: dst_host_virt_addr
        Description: Host Virtual Address in userspace
        Type: uint64_t
      - Name: dst_host_phy_addr
        Description: Host Physical Address in kernelspace
        Type: uint64_t
      - Name: src_device_phy_addr
        Description: Device Address
        Type: uint64_t
      - Name: size
        Description: Size
        Type: uint32_t
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
  - Name: device_ops_data_read_rsp
    Description:  Data read command response
    Type: Response
    PairedMessage: device_ops_data_read_cmd
    Fields:
      - Name: cmd_wait_time
        Description: Time transpired between command arrival and dispatch
        Type: uint64_t
      - Name: cmd_execution_time
        Description: Time transpired between command dispatch and command completion
        Type: uint64_t
      - Name: status
        Description: Status of the DMA operation
        Type: enum
        Enum: dev_ops_api_dma_response
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
  - Name: device_ops_data_write_cmd
    Description: Command to write data to device memory
    Type: Command
    PairedMessage: device_ops_data_write_rsp
    Fields:
      - Name: src_host_virt_addr
        Description: Host Virtual Address in userspace
        Type: uint64_t
      - Name: src_host_phy_addr
        Description: Host Physical Address in kernelspace
        Type: uint64_t
      - Name: dst_device_phy_addr
        Description: Device Address
        Type: uint64_t
      - Name: size
        Description: Size
        Type: uint32_t
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
  - Name: device_ops_data_write_rsp
    Description:  Data write command response
    Type: Response
    PairedMessage: device_ops_data_write_cmd
    Fields:
      - Name: cmd_wait_time
        Description: Time transpired between command arrival and dispatch
        Type: uint64_t
      - Name: cmd_execution_time
        Description: Time transpired between command dispatch and command completion
        Type: uint64_t
      - Name: status
        Description: Status of the DMA operation
        Type: enum
        Enum: dev_ops_api_dma_response
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
# Trace Management Commands and Responses
#-------------------------------------------------------------------------------
  - Name: device_ops_trace_configure_cmd
    Description: Configure the trace configuration
    Type: Command
    PairedMessage: device_ops_trace_configure_rsp
    Fields:
      - Name: thread_mask
        Description: |-
                Bit Mask of Thread within a Shire to enable Trace Capture.
                                         /// It will be the same bit mask for both Master and all Worker Shires.
        Type: uint64_t
      - Name: master_shire_mask
        Description: Bit 0 indicates if master shire mask is enabled/disabled
        Type: uint32_t
      - Name: worker_shire_mask
        Description: Bit Mask of Compute Shires to enable Trace Capture (0-31 shires)
        Type: uint32_t
      - Name: trace_buffer_base
        Description: Base Address of Trace Buffer
        Type: uint32_t
      - Name: trace_buffer_size
        Description: Size (in bytes) of bufffer per hart
        Type: uint32_t
      - Name: buffer_threshold_level
        Description: |-
                Size (in bytes) relative to trace_buffer_size which will cause an overflow event.
                                                    /// Example, user can say when hit 70 bytes, detect event. Expectation is Size of buffer is bigger than this
        Type: uint32_t
      - Name: overflow_event_ctrl
        Description: |-
                When an overflow condition is hit, this will allow control:
                                                 /// Bit 0 - Send Event to Host - Full event defined below
                                                 /// Bit 1 - Stop Device from overwriting data buffer
        Type: uint32_t
  - Name: device_ops_trace_configure_rsp
    Description:  Trace configure command reply
    Type: Response
    PairedMessage: device_ops_trace_configure_cmd
    Fields:
      - Name: status
        Description: DEV_OPS_TRACE_RESPONSE_SUCCESS or negative error code
        Type: enum
        Enum: dev_ops_trace_response
      - Name: pad1
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad2
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad3
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad4
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad5
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad6
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad7
        Description: Padding for alignment
        Type: uint8_t
#-------------------------------------------------------------------------------
  - Name: device_ops_trace_filter_knob_cmd
    Description: Configure the state of a trace group
    Type: Command
    PairedMessage: device_ops_trace_filter_knob_rsp
    Fields:
      - Name: event_mask
        Description: This is a bit mask, each bit corresponds to a event in the group
        Type: uint64_t
      - Name: group_index
        Description: 'This is a unsigned group index. Shortcut: 0xFFFFFFFF enables all events and all groups'
        Type: uint32_t
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
  - Name: device_ops_trace_filter_knob_rsp
    Description: Trace group configure command reply
    Type: Response
    PairedMessage: device_ops_trace_filter_knob_cmd
    Fields:
      - Name: status
        Description: DEV_OPS_TRACE_RESPONSE_SUCCESS or negative error code
        Type: enum
        Enum: dev_ops_trace_response
      - Name: pad1
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad2
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad3
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad4
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad5
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad6
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad7
        Description: Padding for alignment
        Type: uint8_t
#------------------------------------------------------------------------------
  - Name: device_ops_trace_state_ctrl_cmd
    Description: Enables or disables trace component
    Type: Command
    PairedMessage: device_ops_trace_state_ctrl_rsp
    Fields:
      - Name: log_op_target
        Description: Target could be in-memory buffer, or console
        Type: uint8_t
      - Name: log_level
        Description: Determines Trace Log Level
        Type: uint8_t
      - Name: enable
        Description: ENABLE or DISABLE
        Type: uint8_t
      - Name: pad1
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad2
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad3
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad4
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad5
        Description: Padding for alignment
        Type: uint8_t
  - Name: device_ops_trace_state_ctrl_rsp
    Description: Trace enable disable command reply
    Type: Response
    PairedMessage: device_ops_trace_state_ctrl_cmd
    Fields:
      - Name: status
        Description: DEV_OPS_TRACE_RESPONSE_SUCCESS or negative error code
        Type: enum
        Enum: dev_ops_trace_response
      - Name: pad1
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad2
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad3
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad4
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad5
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad6
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad7
        Description: Padding for alignment
        Type: uint8_t
#------------------------------------------------------------------------------
  - Name: device_ops_trace_flush_buffers_cmd
    Description: Flush trace buffers for consumption
    Type: Command
    PairedMessage: device_ops_trace_flush_buffers_rsp
    Fields:
      - Name: dummy
        Type: uint64_t
  - Name: device_ops_trace_flush_buffers_rsp
    Description: Flush trace buffer command reply
    Type: Response
    PairedMessage: device_ops_trace_flush_buffers_cmd
    Fields:
      - Name: status
        Description: DEV_OPS_TRACE_RESPONSE_SUCCESS or negative error code
        Type: enum
        Enum: dev_ops_trace_response
      - Name: pad1
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad2
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad3
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad4
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad5
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad6
        Description: Padding for alignment
        Type: uint8_t
      - Name: pad7
        Description: Padding for alignment
        Type: uint8_t
###################################################################
## List of asynchronous events that device-fw can send to the host
###################################################################
  - Name: device_ops_device_fw_error
    Description: Generic error reported by the device
    Type: Event
    PairedMessage: None
    Fields:
      - Name: error_type
        Type: enum
        Enum: dev_ops_api_error_type
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#------------------------------------------------------------------------------
  - Name: device_ops_trace_buffer_full_event
    Description: Binary trace buffer is full and the host should consume it
    Type: Event
    PairedMessage: None
    Fields:
      - Name: ring_buffer_start
        Type: uint64_t
      - Name: size
        Type: uint64_t
