#------------------------------------------------------------------------------
# Copyright (C) 2019, Esperanto Technologies Inc.
# The copyright to the computer program(s) herein is the
# property of Esperanto Technologies, Inc. All Rights Reserved.
# The program(s) may be used and/or copied only with
# the written permission of Esperanto Technologies and
# in accordance with the terms and conditions stipulated in the
# agreement/contract under which the program(s) have been supplied.
#------------------------------------------------------------------------------
Name: Ops_API_Calls
## List of Enums that are used in our messages
Enums:
  - Name: cmd_flags
    Type: uint16_t
    Values:
      - Name: BARRIER_DISABLE
        Value: 0
      - Name: BARRIER_ENABLE
        Value: 1
      - Name: COMPUTE_KERNEL_TRACE_DISABLE
        Value: 0
      - Name: COMPUTE_KERNEL_TRACE_ENABLE
        Value: 2
      - Name: HOST_MANAGED_UBUF
        Value: 0
      - Name: MMFW_TRACEBUF
        Value: 4
      - Name: CMFW_TRACEBUF
        Value: 8
  - Name: log_levels
    Type: uint8_t
    Values:
      - Name: CRITICAL
        Value: 0
      - Name: ERROR
        Value: 1
      - Name: WARNING
        Value: 2
      - Name: INFO
        Value: 3
      - Name: DEBUG
        Value: 4
      - Name: TRACE
        Value: 5
  - Name: dev_ops_api_kernel_launch_response
    Type: uint32_t
    Values:
      - Name: KERNEL_COMPLETED
        Value: 0
      - Name: ERROR
        Value: 1
      - Name: EXCEPTION
        Value: 2
      - Name: SHIRES_NOT_READY
        Value: 3
      - Name: HOST_ABORTED
        Value: 4
      - Name: INVALID_ADDRESS
        Value: 5
      - Name: TIMEOUT_HANG
        Value: 6
      - Name: INVALID_ARGS_PAYLOAD_SIZE
        Value: 7
  - Name: dev_ops_api_kernel_abort_response
    Type: uint32_t
    Values:
      - Name: SUCCESS
        Value: 0
      - Name : ERROR
        Value : 1
      - Name : INVALID_TAG_ID
        Value : 2
      - Name : TIMEOUT_HANG
        Value: 3
  - Name: dev_ops_api_dma_response
    Type: uint32_t
    Values:
      - Name: COMPLETE
        Value: 0
      - Name: ERROR
        Value: 1
      - Name: TIMEOUT_IDLE_CHANNEL_UNAVAILABLE
        Value: 2
      - Name: ABORTED
        Value: 3
      - Name: TIMEOUT_HANG
        Value: 4
      - Name: INVALID_ADDRESS
        Value: 5
      - Name: INVALID_SIZE
        Value: 6
  - Name: dev_ops_api_error_type
    Type: uint32_t
    Values:
      - Name: NONE
        Value: 0
      - Name: ASYNC_ERROR_0
        Value: 1
  - Name: dev_ops_fw_type
    Type: uint8_t
    Values:
      - Name: MASTER_MINION_FW
        Value: 0
      - Name: MACHINE_MINION_FW
        Value: 1
      - Name: WORKER_MINION_FW
        Value: 2
  - Name: dev_ops_trace_rt_config_response
    Type: uint32_t
    Values:
      - Name: SUCCESS
        Value: 0
      - Name: BAD_SHIRE_MASK
        Value: 1
      - Name: BAD_THREAD_MASK
        Value: 2
      - Name: BAD_EVENT_MASK
        Value: 3
      - Name: BAD_FILTER_MASK
        Value: 4
  - Name: dev_ops_trace_rt_control_response
    Type: uint32_t
    Values:
      - Name: SUCCESS
        Value: 0
      - Name: BAD_RT_TYPE
        Value: 1
      - Name: BAD_CONTROL_MASK
        Value: 2

Structs:
  - Name: dma_read_node
    Description: Node containing one DMA read transfer information
    Fields:
      - Name: dst_host_virt_addr
        Description: Host Virtual Address
        Type: uint64_t
      - Name: dst_host_phy_addr
        Description: Host Physical Address
        Type: uint64_t
      - Name: src_device_phy_addr
        Description: Device Address
        Type: uint64_t
      - Name: size
        Description: Size
        Type: uint32_t
      - Name: pad[4]
        Description: Padding for alignment
        Type: uint8_t
  - Name: dma_write_node
    Description: Node containing one DMA write transfer information
    Fields:
      - Name: src_host_virt_addr
        Description: Host Virtual Address
        Type: uint64_t
      - Name: src_host_phy_addr
        Description: Host Physical Address
        Type: uint64_t
      - Name: dst_device_phy_addr
        Description: Device Address
        Type: uint64_t
      - Name: size
        Description: Size
        Type: uint32_t
      - Name: pad[4]
        Description: Padding for alignment
        Type: uint8_t

## List of Commands, Responses, and Events
Messages :
#-------------------------------------------------------------------------------
  - Name: check_device_ops_api_compatibility_cmd
    Description:  Request the version of the device_ops_api supported
                  by the target, advertise the one we support
    Type: Command
    PairedMessage: device_ops_api_compatibility_rsp
    Fields:
      - Name: major
        Description: Sem Version Major
        Type: uint16_t
      - Name: minor
        Description: Sem Version Minor
        Type: uint16_t
      - Name: patch
        Description: Sem Version Patch
        Type: uint16_t
      - Name: pad
        Description: Padding for alignment
        Type: uint16_t
  - Name: device_ops_api_compatibility_rsp
    Type: Response
    Description: Return the version implemented by the target
    PairedMessage: check_device_ops_api_compatibility_cmd
    Fields:
      - Name: major
        Description: Sem Version Major
        Type: uint16_t
      - Name: minor
        Description: Sem Version Minor
        Type: uint16_t
      - Name: patch
        Description: Sem Version Patch
        Type: uint16_t
      - Name: pad
        Description: Padding for alignment
        Type: uint16_t
#-------------------------------------------------------------------------------
  - Name: device_ops_device_fw_version_cmd
    Description:  Request the version of the device firmware, advertise the one we support
    Type: Command
    PairedMessage: device_ops_fw_version_rsp
    Fields:
      - Name: firmware_type
        Description: Identify device firmware type
        Type: enum
        Enum: dev_ops_fw_type
      - Name: pad[7]
        Description: Padding for alignment
        Type: uint8_t
  - Name: device_ops_fw_version_rsp
    Type: Response
    Description: Return the device fw version for the requested type
    PairedMessage: device_ops_device_fw_version_cmd
    Fields:
      - Name: major
        Description: Sem Version Major
        Type: uint16_t
      - Name: minor
        Description: Sem Version Minor
        Type: uint16_t
      - Name: patch
        Description: Sem Version Patch
        Type: uint16_t
      - Name: type
        Description: Device firmware type
        Type: enum
        Enum: dev_ops_fw_type
      - Name: pad
        Description: Padding for alignment
        Type: uint8_t
#-------------------------------------------------------------------------------
  - Name: device_ops_echo_cmd
    Description: Echo command
    Type: Command
    PairedMessage: device_ops_echo_rsp
    Fields:
      - Name: echo_payload
        Description: Echo payload field
        Type: int32_t
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
  - Name: device_ops_echo_rsp
    Description:  Echo response
    Type: Response
    PairedMessage: device_ops_echo_cmd
    Fields:
      - Name: echo_payload
        Description: Echo payload field
        Type: int32_t
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
# Kernel Execution Commands and Responses
#-------------------------------------------------------------------------------
  - Name: device_ops_kernel_launch_cmd
    Description: Launch a kernel on the target
    PairedMessage: device_ops_kernel_launch_rsp
    Type: Command
    Fields:
      - Name: code_start_address
        Description: Starting address of the location of the Compute Kernel code
        Type : uint64_t
      - Name: pointer_to_args
        Description: Pointer to kernel arguments
        Type : uint64_t
      - Name: exception_buffer
        Description: Pointer to the exception buffer
        Type : uint64_t
      - Name: shire_mask
        Description: BitMask indicating Compute Shires that is used to execute a given Kernel
        Type : uint64_t
      - Name: kernel_trace_buffer
        Description: Pointer to Host Runtime allocation Trace buffer (optional)
        Type : uint64_t
      - Name: argument_payload[]
        Description: |-
                These are user provided values and can go up to 64 bytes
                            /// Device will copy this to the pointer_to_args address
                            /// User will update the Size in the header to reflect the actual size of this payload
        Type : uint64_t
  - Name: device_ops_kernel_launch_rsp
    Description: Response and result of a kernel launch on the device
    Type: Response
    PairedMessage: device_ops_kernel_launch_cmd
    Fields:
      - Name: cmd_wait_time
        Description: Time transpired between command arrival and dispatch
        Type: uint64_t
      - Name: cmd_execution_time
        Description: Time transpired between command dispatch and command completion
        Type: uint64_t
      - Name: status
        Description: Kernel Launch status
        Type: enum
        Enum: dev_ops_api_kernel_launch_response
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
  - Name: device_ops_kernel_abort_cmd
    Description: Command to abort a currently running kernel on the device
    Type: Command
    PairedMessage: device_ops_kernel_abort_rsp
    Fields:
      - Name: kernel_launch_tag_id
        Description: Tag ID of the kernel_launch command the we want to abort
        Type: uint16_t
      - Name: pad[6]
        Description: Padding for alignment
        Type: uint8_t
  - Name: device_ops_kernel_abort_rsp
    Description: Response to an abort request
    PairedMessage: device_ops_kernel_abort_cmd
    Type: Response
    Fields:
      - Name: status
        Description: Kernel Abort status
        Type: enum
        Enum: dev_ops_api_kernel_abort_response
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
# Data Transfer Commands and Responses
#-------------------------------------------------------------------------------
  - Name: device_ops_data_read_cmd
    Description: Command to read data from device memory
    Type: Command
    PairedMessage: device_ops_data_read_rsp
    Fields:
      - Name: dst_host_virt_addr
        Description: Host Virtual Address in userspace
        Type: uint64_t
      - Name: dst_host_phy_addr
        Description: Host Physical Address in kernelspace
        Type: uint64_t
      - Name: src_device_phy_addr
        Description: Device Address
        Type: uint64_t
      - Name: size
        Description: Size
        Type: uint32_t
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
  - Name: device_ops_data_read_rsp
    Description:  Data read command response
    Type: Response
    PairedMessage: device_ops_data_read_cmd
    Fields:
      - Name: cmd_wait_time
        Description: Time transpired between command arrival and dispatch
        Type: uint64_t
      - Name: cmd_execution_time
        Description: Time transpired between command dispatch and command completion
        Type: uint64_t
      - Name: status
        Description: Status of the DMA operation
        Type: enum
        Enum: dev_ops_api_dma_response
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
  - Name: device_ops_data_write_cmd
    Description: Command to write data to device memory
    Type: Command
    PairedMessage: device_ops_data_write_rsp
    Fields:
      - Name: src_host_virt_addr
        Description: Host Virtual Address in userspace
        Type: uint64_t
      - Name: src_host_phy_addr
        Description: Host Physical Address in kernelspace
        Type: uint64_t
      - Name: dst_device_phy_addr
        Description: Device Address
        Type: uint64_t
      - Name: size
        Description: Size
        Type: uint32_t
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
  - Name: device_ops_data_write_rsp
    Description:  Data write command response
    Type: Response
    PairedMessage: device_ops_data_write_cmd
    Fields:
      - Name: cmd_wait_time
        Description: Time transpired between command arrival and dispatch
        Type: uint64_t
      - Name: cmd_execution_time
        Description: Time transpired between command dispatch and command completion
        Type: uint64_t
      - Name: status
        Description: Status of the DMA operation
        Type: enum
        Enum: dev_ops_api_dma_response
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#-------------------------------------------------------------------------------
# DMA Transfer list Commands and Responses
#-------------------------------------------------------------------------------
  - Name: device_ops_dma_readlist_cmd
    Description: Single list Command to perform multiple DMA reads from device memory
    Type: Command
    PairedMessage: device_ops_dma_readlist_rsp
    Fields:
      - Name: list[]
        Description: |-
                Arrays of Structs containing Src/Dst/Size of numerous data transfers to be performed in a single command.
                            /// Each entry is 1 Data transfer with its own Src/Dst/Size
        Type: struct
        Struct: dma_read_node
  - Name: device_ops_dma_readlist_rsp
    Description:  DMA readlist command response
    Type: Response
    PairedMessage: device_ops_dma_readlist_cmd
    Fields:
      - Name: cmd_wait_time
        Description: Time transpired between command arrival and dispatch
        Type: uint64_t
      - Name: cmd_execution_time
        Description: Time transpired between command dispatch and command completion
        Type: uint64_t
      - Name: status
        Description: Status of the DMA operation
        Type: enum
        Enum: dev_ops_api_dma_response
      - Name: pad[4]
        Description: Padding for alignment
        Type: uint8_t
#-------------------------------------------------------------------------------
  - Name: device_ops_dma_writelist_cmd
    Description: Single list Command to perform multiple DMA writes on device memory
    Type: Command
    PairedMessage: device_ops_dma_writelist_rsp
    Fields:
      - Name: list[]
        Description: |-
                Arrays of Structs containing Src/Dst/Size of numerous data transfers to be performed in a single command.
                            /// Each entry is 1 Data transfer with its own Src/Dst/Size
        Type: struct
        Struct: dma_write_node
  - Name: device_ops_dma_writelist_rsp
    Description:  DMA writelist command response
    Type: Response
    PairedMessage: device_ops_dma_writelist_cmd
    Fields:
      - Name: cmd_wait_time
        Description: Time transpired between command arrival and dispatch
        Type: uint64_t
      - Name: cmd_execution_time
        Description: Time transpired between command dispatch and command completion
        Type: uint64_t
      - Name: status
        Description: Status of the DMA operation
        Type: enum
        Enum: dev_ops_api_dma_response
      - Name: pad[4]
        Description: Padding for alignment
        Type: uint8_t
#-------------------------------------------------------------------------------
# Trace Management Commands and Responses
#-------------------------------------------------------------------------------
  - Name: device_ops_trace_rt_config_cmd
    Description: Configure the trace configuration
    Type: Command
    PairedMessage: device_ops_trace_rt_config_rsp
    Fields:
      - Name: shire_mask
        Description: Bit Mask of Shire to enable Trace Capture
        Type: uint32_t
      - Name: thread_mask
        Description: Bit Mask of Thread within a Shire to enable Trace Capture
        Type: uint32_t
      - Name: event_mask
        Description: This is a bit mask, each bit corresponds to a specific Event to trace
        Type: uint32_t
      - Name: filter_mask
        Description: This is a bit mask representing a list of filters for a given event to trace
        Type: uint32_t
  - Name: device_ops_trace_rt_config_rsp
    Description:  Trace configure command reply
    Type: Response
    PairedMessage: device_ops_trace_rt_config_cmd
    Fields:
      - Name: status
        Description: DEV_OPS_TRACE_RT_CONFIG_RESPONSE_SUCCESS or non-zero error code
        Type: enum
        Enum: dev_ops_trace_rt_config_response
      - Name: pad[4]
        Description: Padding for alignment
        Type: uint8_t
#-------------------------------------------------------------------------------
  - Name: device_ops_trace_rt_control_cmd
    Description: Contains options to start OR stop trace collection
    Type: Command
    PairedMessage: device_ops_trace_rt_control_rsp
    Fields:
      - Name: rt_type
        Description: Trace runtime buffer type
        Type: uint32_t
      - Name: control
        Description: |-
                This is a bit mask that controls functionality
                                     /// bit-0: 0 - instructs devive runtime to stop tracing
                                     ///        1 - instructs device runtime to start tracing
                                     /// bit-1: 0 - Dump to Trace Buffer (Default)
                                     ///        1 - Dump to UART
                                     /// bit-2: 0 - Dont evict
                                     ///        1 - Evict memory
                                     /// bit-3: 0 - Evict cache to L3
                                     ///        1 - Evict cache to MEM
        Type: uint32_t
  - Name: device_ops_trace_rt_control_rsp
    Description: Trace runtime control command reply
    Type: Response
    PairedMessage: device_ops_trace_rt_control_cmd
    Fields:
      - Name: status
        Description: DEV_OPS_TRACE_RT_CONTROL_RESPONSE_SUCCESS or non-zero error code
        Type: enum
        Enum: dev_ops_trace_rt_control_response
      - Name: pad[4]
        Description: Padding for alignment
        Type: uint8_t
#------------------------------------------------------------------------------
###################################################################
## List of asynchronous events that device-fw can send to the host
###################################################################
  - Name: device_ops_device_fw_error
    Description: Generic error reported by the device
    Type: Event
    PairedMessage: None
    Fields:
      - Name: error_type
        Type: enum
        Enum: dev_ops_api_error_type
      - Name: pad
        Description: Padding for alignment
        Type: uint32_t
#------------------------------------------------------------------------------
  - Name: device_ops_trace_buffer_full_event
    Description: Binary trace buffer is full and the host should consume it
    Type: Event
    PairedMessage: None
    Fields:
      - Name: ring_buffer_start
        Type: uint64_t
      - Name: size
        Type: uint64_t
